{"version":3,"file":"vasoft-dzen.bundle.js","sources":["../src/application.js"],"sourcesContent":["import './assets/styles.css';\n\nexport class DzenLinks {\n    links = [];\n    popup = null;\n    video = null;\n    init(className): void {\n        if (window.frameCacheVars !== undefined) {\n            BX.addCustomEvent(\"onFrameDataReceived\", (json) => this.initItems(className));\n        } else {\n            BX.ready((json) => this.initItems(className));\n        }\n    }\n\n    initItems(className):void{\n        this.links = document.querySelectorAll(className + '[data-dzenId]');\n        for (let i = 0, c = this.links.length; i < c; ++i) {\n            if (!this.links[i].getAttribute('data-dzenEnabled')) {\n                this.links[i].addEventListener('click', this.clickHandler.bind(this), true);\n                this.links[i].setAttribute('data-dzenEnabled', 1);\n            }\n        }\n    }\n\n    clickHandler(event): void {\n        event.stopPropagation();\n        event.preventDefault();\n        this.renderPopup();\n        this.renderVideo(event.target.getAttribute('data-dzenId'));\n    }\n\n    closeHandler(event): void {\n        event.stopPropagation();\n        event.preventDefault();\n        this.removePopup();\n        this.removeVideo();\n    }\n\n    removePopup(): void {\n        if (this.popup) {\n            this.popup.classList.add('vs-dzen-hide')\n        }\n    }\n\n    removeVideo(): void {\n        if (this.video) {\n            this.video.parentNode.removeChild(this.video);\n            this.video = null;\n        }\n    }\n\n    renderPopup(): void {\n        if (!this.popup) {\n            this.popup = document.createElement('div');\n            this.popup.className = \"vs-dzen-popup\";\n            this.popup.addEventListener('click', this.closeHandler.bind(this), true);\n\n            let close = document.createElement('div');\n            close.className = \"vs-dzen-close\";\n            this.popup.append(close);\n            document.body.append(this.popup);\n        } else {\n            this.popup.classList.remove('vs-dzen-hide');\n        }\n    }\n\n    calcSize() {\n        let screenWidth = this.popup.clientWidth, screenHeight = this.popup.clientHeight;\n        const result = {\n            width: screenWidth > 1920 ? 1920 : screenWidth,\n            height: 0\n        };\n        result.height = Math.floor(result.width * 0.5625);\n        if (result.height > screenHeight) {\n            result.width = Math.floor(screenHeight / 0.5625);\n        }\n        return result;\n    }\n\n    renderVideo(code): void {\n        const size = this.calcSize();\n        this.video = document.createElement('div');\n        this.video.className = \"vs-dzen-video\";\n        this.video.innerHTML = '<iframe width=\"' + size.width + '\" height=\"' + size.height + '\"' +\n            ' src=\"https://dzen.ru/embed/' + code + '?from_block=partner&from=zen&backoffice=1&autoplay=1&tv=0\"' +\n            ' allow=\"au2toplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media\"' +\n            ' frameBorder=\"0\" scrolling=\"no\" allowFullScreen=\"yes\"></iframe>';\n        this.popup.append(this.video);\n    }\n}"],"names":["DzenLinks","babelHelpers","key","value","className","undefined","window","frameCacheVars","BX","addCustomEvent","json","_this","initItems","ready","this","links","document","querySelectorAll","i","c","length","getAttribute","addEventListener","clickHandler","bind","setAttribute","event","stopPropagation","preventDefault","renderPopup","renderVideo","target","removePopup","removeVideo","popup","classList","add","video","parentNode","removeChild","remove","createElement","closeHandler","close","append","body","screenWidth","clientWidth","screenHeight","clientHeight","result","width","height","Math","floor","code","size","calcSize","innerHTML"],"mappings":"iDAEaA,aAAS,aAAAC,oCAAAA,yCACV,IAAEA,yCACF,MAAIA,yCACJ,MAmFP,OAnFWA,6BAAAC,WAAAC,eACPC,GAAiB,gBACYC,IAA1BC,OAAOC,eACPC,GAAGC,eAAe,uBAAuB,SAACC,GAAI,OAAKC,EAAKC,UAAUR,MAElEI,GAAGK,OAAM,SAACH,GAAI,OAAKC,EAAKC,UAAUR,SAEzCF,gBAAAC,eAESC,GACNU,KAAKC,MAAQC,SAASC,iBAAiBb,EAAY,iBACnD,IAAK,IAAIc,EAAI,EAAGC,EAAIL,KAAKC,MAAMK,OAAQF,EAAIC,IAAKD,EACvCJ,KAAKC,MAAMG,GAAGG,aAAa,sBAC5BP,KAAKC,MAAMG,GAAGI,iBAAiB,QAASR,KAAKS,aAAaC,KAAKV,OAAO,GACtEA,KAAKC,MAAMG,GAAGO,aAAa,mBAAoB,OAG1DvB,mBAAAC,eAEYuB,GACTA,EAAMC,kBACND,EAAME,iBACNd,KAAKe,cACLf,KAAKgB,YAAYJ,EAAMK,OAAOV,aAAa,mBAC9CnB,mBAAAC,eAEYuB,GACTA,EAAMC,kBACND,EAAME,iBACNd,KAAKkB,cACLlB,KAAKmB,iBACR/B,kBAAAC,iBAGOW,KAAKoB,OACLpB,KAAKoB,MAAMC,UAAUC,IAAI,mBAEhClC,kBAAAC,iBAGOW,KAAKuB,QACLvB,KAAKuB,MAAMC,WAAWC,YAAYzB,KAAKuB,OACvCvB,KAAKuB,MAAQ,SAEpBnC,kBAAAC,iBAGG,GAAKW,KAAKoB,MAUNpB,KAAKoB,MAAMC,UAAUK,OAAO,oBAVf,CACb1B,KAAKoB,MAAQlB,SAASyB,cAAc,OACpC3B,KAAKoB,MAAM9B,UAAY,gBACvBU,KAAKoB,MAAMZ,iBAAiB,QAASR,KAAK4B,aAAalB,KAAKV,OAAO,GAEnE,IAAI6B,EAAQ3B,SAASyB,cAAc,OACnCE,EAAMvC,UAAY,gBAClBU,KAAKoB,MAAMU,OAAOD,GAClB3B,SAAS6B,KAAKD,OAAO9B,KAAKoB,WAIjChC,eAAAC,iBAGG,IAAI2C,EAAchC,KAAKoB,MAAMa,YAAaC,EAAelC,KAAKoB,MAAMe,aAC9DC,EAAS,CACXC,MAAOL,EAAc,KAAO,KAAOA,EACnCM,OAAQ,GAMZ,OAJAF,EAAOE,OAASC,KAAKC,MAAqB,MAAfJ,EAAOC,OAC9BD,EAAOE,OAASJ,IAChBE,EAAOC,MAAQE,KAAKC,MAAMN,EAAe,QAEtCE,KACVhD,kBAAAC,eAEWoD,GACR,IAAMC,EAAO1C,KAAK2C,WAClB3C,KAAKuB,MAAQrB,SAASyB,cAAc,OACpC3B,KAAKuB,MAAMjC,UAAY,gBACvBU,KAAKuB,MAAMqB,UAAY,kBAAoBF,EAAKL,MAAQ,aAAeK,EAAKJ,OAArD,gCACcG,EADd,yNAIvBzC,KAAKoB,MAAMU,OAAO9B,KAAKuB"}